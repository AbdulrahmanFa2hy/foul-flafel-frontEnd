<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arabic Thermal Printer Test - HTML Printing Approach</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #333;
        line-height: 1.6;
      }

      .container {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      h1 {
        color: #4a5568;
        text-align: center;
        margin-bottom: 30px;
        font-size: 28px;
        border-bottom: 3px solid #667eea;
        padding-bottom: 15px;
      }

      .section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        background: #f8fafc;
      }

      .section h2 {
        color: #2d3748;
        margin-bottom: 15px;
        font-size: 20px;
      }

      .button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        margin: 5px;
        transition: all 0.3s ease;
      }

      .button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      }

      .button:disabled {
        background: #a0aec0;
        cursor: not-allowed;
        transform: none;
      }

      .status {
        margin: 15px 0;
        padding: 12px;
        border-radius: 8px;
        font-weight: bold;
      }

      .status.success {
        background: #c6f6d5;
        color: #22543d;
        border: 1px solid #9ae6b4;
      }

      .status.error {
        background: #fed7d7;
        color: #742a2a;
        border: 1px solid #fc8181;
      }

      .status.info {
        background: #bee3f8;
        color: #2a4365;
        border: 1px solid #63b3ed;
      }

      .printer-info {
        background: #edf2f7;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        font-family: monospace;
      }

      .arabic-sample {
        font-family: 'Noto Sans Arabic', 'Amiri', Arial, sans-serif;
        font-size: 18px;
        line-height: 1.8;
        direction: rtl;
        text-align: right;
        background: #f7fafc;
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid #667eea;
        margin: 15px 0;
      }

      .receipt-preview {
        width: 80mm;
        max-width: 300px;
        margin: 20px auto;
        border: 1px solid #ccc;
        padding: 10px;
        background: white;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      }

      .loading {
        text-align: center;
        color: #666;
      }

      .highlight-box {
        background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
      }

      .warning-box {
        background: #fff5f5;
        border: 1px solid #fc8181;
        color: #742a2a;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
      }

      .code-block {
        background: #2d3748;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        overflow-x: auto;
        margin: 15px 0;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .printer-list {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 10px;
      }

      .printer-item {
        padding: 8px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
        transition: background 0.2s;
      }

      .printer-item:hover {
        background: #f7fafc;
      }

      .printer-item.selected {
        background: #ebf8ff;
        border-left: 3px solid #3182ce;
      }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qz-tray@2.2.4/qz-tray.min.js"></script>
  </head>
  <body>
    <div class="container">
      <h1>üñ®Ô∏è Arabic Thermal Printer Test - HTML Printing Method</h1>
      
      <div class="highlight-box">
        <h3>‚ú® New HTML-Based Approach for Arabic Printing</h3>
        <p>This test page uses QZ Tray's HTML printing method instead of raw ESC/POS commands. 
           Based on extensive research, this approach is much more reliable for Arabic text printing.</p>
      </div>

      <div class="section">
        <h2>üîå QZ Tray Connection</h2>
        <button class="button" onclick="connectQZ()" id="connectBtn">Connect to QZ Tray</button>
        <button class="button" onclick="disconnectQZ()" id="disconnectBtn" disabled>Disconnect</button>
        <div id="connectionStatus" class="status info">Not connected to QZ Tray</div>
      .arabic-text {
        direction: rtl;
        text-align: right;
        font-size: 18px;
        line-height: 1.8;
        background: #f1f2f6;
        padding: 15px;
        border-radius: 8px;
        border-right: 4px solid #00a8ff;
        margin: 10px 0;
      }

      .code-block {
        background: #2c3e50;
        color: #ecf0f1;
        padding: 20px;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        font-size: 14px;
        overflow-x: auto;
        margin: 15px 0;
      }

      .highlight {
        background: #e74c3c;
        color: white;
        padding: 2px 6px;
        border-radius: 4px;
      }

      .features {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 15px 0;
      }

      .feature {
        background: #27ae60;
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
      }

      .logs {
        background: #2c3e50;
        color: #ecf0f1;
        padding: 15px;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
        margin: 15px 0;
      }

      .receipt-preview {
        background: #f8f9fa;
        border: 2px dashed #bdc3c7;
        border-radius: 8px;
        padding: 20px;
        font-family: "Courier New", monospace;
        font-size: 14px;
        line-height: 1.4;
        white-space: pre-line;
        direction: rtl;
        text-align: right;
        max-height: 500px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üá∏üá¶ Arabic Thermal Printer Test</h1>
      <p class="subtitle">
        Complete QZ Tray Integration with IBM864 Encoding & RTL Support
      </p>

      <div id="status" class="status warning">
        Initializing QZ Tray connection...
      </div>

      <div class="grid">
        <div class="card">
          <h3>üñ®Ô∏è QZ Tray Controls</h3>
          <button class="btn btn-primary" onclick="connectQZ()">
            Connect to QZ Tray
          </button>
          <button class="btn btn-primary" onclick="findPrinters()">
            Find Printers
          </button>
          <button class="btn btn-warning" onclick="checkQZStatus()">
            Check Status
          </button>
        </div>

        <div class="card">
          <h3>üìÑ Arabic Receipt Tests</h3>
          <button class="btn btn-success" onclick="printFullArabicReceipt()">
            Print Complete Arabic Receipt
          </button>
          <button class="btn btn-success" onclick="printSimpleArabicTest()">
            Print Simple Arabic Test
          </button>
          <button class="btn btn-success" onclick="previewArabicReceipt()">
            Preview Arabic Receipt
          </button>
        </div>
      </div>

      <div class="card">
        <h3>‚ú® Features Implemented</h3>
        <div class="features">
          <span class="feature">IBM864 Encoding</span>
          <span class="feature">RTL Text Direction</span>
          <span class="feature">Arabic Numerals</span>
          <span class="feature">QZ Tray Integration</span>
          <span class="feature">ESC/POS Commands</span>
          <span class="feature">Proper Alignment</span>
          <span class="feature">Mixed Content</span>
          <span class="feature">Receipt Structure</span>
        </div>
      </div>

      <div class="card">
        <h3>üîß Technical Implementation</h3>
        <div class="code-block">
          // QZ Tray Configuration for Arabic Printing var config =
          qz.configs.create("Printer Name", { encoding: 'IBM864' // Critical for
          Arabic support }); // ESC/POS Commands for Arabic var data = [
          '\x1B\x40', // Initialize printer '\x1B\x74\x25', // Set IBM864
          codepage '\x1B\x52\x11', // Set Arabic character set '\x1B\x61\x02',
          // Right align for Arabic text 'ŸÖÿ∑ÿπŸÖ ÿßŸÑŸÅŸàŸÑ ŸàÿßŸÑŸÅŸÑÿßŸÅŸÑ', // Arabic text
          '\x0A', // Line feed '\x1B\x61\x00', // Left align for numbers '57.50
          ÿ±ŸäÿßŸÑ', // Price with Arabic currency '\x1B\x69' // Cut paper ];
          qz.print(config, data);
        </div>
      </div>

      <div class="card">
        <h3>üìù Sample Arabic Content</h3>
        <div class="arabic-text">
          ŸÖÿ∑ÿπŸÖ ÿßŸÑŸÅŸàŸÑ ŸàÿßŸÑŸÅŸÑÿßŸÅŸÑ<br />
          ÿ¥ÿßÿ±ÿπ ÿßŸÑŸÖŸÑŸÉ ŸÅŸáÿØÿå ÿßŸÑÿ±Ÿäÿßÿ∂<br />
          ÿßŸÑŸáÿßÿ™ŸÅ: Ÿ†Ÿ°Ÿ°-Ÿ§Ÿ•Ÿ¶-ŸßŸ®Ÿ©Ÿ†<br />
          ÿßŸÑÿ±ŸÇŸÖ ÿßŸÑÿ∂ÿ±Ÿäÿ®Ÿä: Ÿ£Ÿ†Ÿ†-Ÿ§Ÿ•Ÿ¶-ŸßŸ®Ÿ©<br /><br />

          ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ®: Ÿ°Ÿ¢Ÿ£Ÿ§Ÿ•<br />
          ÿßŸÑŸÉÿßÿ¥Ÿäÿ±: ÿ£ÿ≠ŸÖÿØ ŸÖÿ≠ŸÖÿØ<br /><br />

          ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ∑ŸÑÿ®:<br />
          ŸÅŸàŸÑ ŸÖÿØŸÖÿ≥ Ÿ¢ √ó Ÿ°Ÿ•.Ÿ•Ÿ† = Ÿ£Ÿ°.Ÿ†Ÿ† ÿ±ŸäÿßŸÑ<br />
          ŸÅŸÑÿßŸÅŸÑ ŸÖÿπ ÿßŸÑÿ∑ÿ≠ŸäŸÜÿ© Ÿ° √ó Ÿ°Ÿ¢.Ÿ†Ÿ† = Ÿ°Ÿ¢.Ÿ†Ÿ† ÿ±ŸäÿßŸÑ<br /><br />

          ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÉŸÑŸä: Ÿ¶Ÿ¶.Ÿ°Ÿ£ ÿ±ŸäÿßŸÑ<br />
          ÿ¥ŸÉÿ±ÿßŸã ŸÑÿ≤Ÿäÿßÿ±ÿ™ŸÉŸÖ
        </div>
      </div>

      <div class="card">
        <h3>ÔøΩÔøΩ Receipt Preview</h3>
        <div id="receiptPreview" class="receipt-preview">
          Click "Preview Arabic Receipt" to see the formatted receipt...
        </div>
      </div>

      <div class="card">
        <h3>üìã System Logs</h3>
        <div id="logs" class="logs">
          System initialized. Ready for Arabic printing tests...
        </div>
      </div>
    </div>

    <!-- QZ Tray Library -->
    <script src="https://cdn.jsdelivr.net/npm/qz-tray@2.2.4/qz-tray.min.js"></script>

    <script>
      let qzConnected = false;
      let selectedPrinter = null;

      // Logging function
      function log(message, type = "info") {
        const logs = document.getElementById("logs");
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
        logs.textContent += logEntry;
        logs.scrollTop = logs.scrollHeight;
        console.log(logEntry);
      }

      // Update status
      function updateStatus(message, type) {
        const status = document.getElementById("status");
        status.textContent = message;
        status.className = `status ${type}`;
      }

      // Connect to QZ Tray
      async function connectQZ() {
        try {
          log("Attempting to connect to QZ Tray...");
          await qz.websocket.connect();
          qzConnected = true;
          updateStatus("‚úÖ Connected to QZ Tray successfully!", "success");
          log("QZ Tray connected successfully");

          // Auto-find printers after connection
          await findPrinters();
        } catch (error) {
          qzConnected = false;
          updateStatus(
            "‚ùå Failed to connect to QZ Tray. Make sure it's running.",
            "error"
          );
          log(`Connection failed: ${error.message}`, "error");
        }
      }

      // Find available printers
      async function findPrinters() {
        if (!qzConnected) {
          updateStatus("‚ö†Ô∏è Please connect to QZ Tray first", "warning");
          return;
        }

        try {
          log("Searching for available printers...");
          const printers = await qz.printers.find();

          if (printers.length > 0) {
            selectedPrinter = printers[0]; // Select first printer
            log(`Found ${printers.length} printer(s):`);
            printers.forEach((printer, index) => {
              log(`  ${index + 1}. ${printer}`);
            });
            log(`Selected printer: ${selectedPrinter}`);
            updateStatus(
              `üñ®Ô∏è Found ${printers.length} printer(s). Selected: ${selectedPrinter}`,
              "success"
            );
          } else {
            updateStatus(
              "‚ö†Ô∏è No printers found. Please check printer connections.",
              "warning"
            );
            log("No printers found", "warning");
          }
        } catch (error) {
          updateStatus("‚ùå Error finding printers", "error");
          log(`Error finding printers: ${error.message}`, "error");
        }
      }

      // Check QZ Tray status
      async function checkQZStatus() {
        try {
          if (qz.websocket.isActive()) {
            const version = await qz.websocket.getVersion();
            updateStatus(
              `‚úÖ QZ Tray ${version} is active and ready`,
              "success"
            );
            log(`QZ Tray version: ${version}`);
          } else {
            updateStatus("‚ùå QZ Tray is not active", "error");
            log("QZ Tray is not active", "error");
          }
        } catch (error) {
          updateStatus("‚ùå Error checking QZ Tray status", "error");
          log(`Status check failed: ${error.message}`, "error");
        }
      }

      // Print complete Arabic receipt
      async function printFullArabicReceipt() {
        if (!qzConnected || !selectedPrinter) {
          updateStatus(
            "‚ö†Ô∏è Please connect to QZ Tray and select a printer first",
            "warning"
          );
          return;
        }

        try {
          log("Generating complete Arabic receipt...");

          // Create QZ config with IBM864 encoding
          const config = qz.configs.create(selectedPrinter, {
            encoding: "IBM864",
            endOfDoc: "\n",
          });

          // Generate complete Arabic receipt data
          const receiptData = generateArabicReceiptCommands();

          const printData = [
            {
              type: "raw",
              format: "plain",
              data: receiptData,
            },
          ];

          log("Sending Arabic receipt to printer...");
          await qz.print(config, printData);

          updateStatus("‚úÖ Arabic receipt printed successfully!", "success");
          log("Arabic receipt printed successfully with IBM864 encoding");
        } catch (error) {
          updateStatus("‚ùå Failed to print Arabic receipt", "error");
          log(`Print failed: ${error.message}`, "error");
        }
      }

      // Print simple Arabic test
      async function printSimpleArabicTest() {
        if (!qzConnected || !selectedPrinter) {
          updateStatus(
            "‚ö†Ô∏è Please connect to QZ Tray and select a printer first",
            "warning"
          );
          return;
        }

        try {
          log("Printing simple Arabic test...");

          const config = qz.configs.create(selectedPrinter, {
            encoding: "IBM864",
          });

          const testData = [
            "\x1B\x40", // Initialize
            "\x1B\x74\x25", // Set IBM864 codepage
            "\x1B\x52\x11", // Set Arabic character set
            "\x1B\x61\x01", // Center align
            "\x1B\x45\x01", // Bold on
            "ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ∑ÿ®ÿßÿπÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ©\n", // Arabic Test Print
            "\x1B\x45\x00", // Bold off
            "\x1B\x61\x02", // Right align
            "ŸÖÿ∑ÿπŸÖ ÿßŸÑŸÅŸàŸÑ ŸàÿßŸÑŸÅŸÑÿßŸÅŸÑ\n", // Restaurant name
            "ÿßŸÑÿ±Ÿäÿßÿ∂ÿå ÿßŸÑŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©\n", // Riyadh, Saudi Arabia
            "\x1B\x61\x00", // Left align
            "Test completed successfully!\n",
            "\n\n\n",
            "\x1B\x69", // Cut paper
          ];

          const printData = [
            {
              type: "raw",
              format: "plain",
              data: testData.join(""),
            },
          ];

          await qz.print(config, printData);
          updateStatus("‚úÖ Simple Arabic test printed!", "success");
          log("Simple Arabic test completed successfully");
        } catch (error) {
          updateStatus("‚ùå Simple Arabic test failed", "error");
          log(`Simple test failed: ${error.message}`, "error");
        }
      }

      // Preview Arabic receipt
      function previewArabicReceipt() {
        log("Generating Arabic receipt preview...");

        const receiptCommands = generateArabicReceiptCommands();
        const preview = convertCommandsToPreview(receiptCommands);

        document.getElementById("receiptPreview").textContent = preview;
        updateStatus("üìÑ Arabic receipt preview generated", "success");
        log("Receipt preview generated successfully");
      }

      // Generate Arabic receipt commands
      function generateArabicReceiptCommands() {
        const commands = [
          "\x1B\x40", // Initialize printer
          "\x1B\x74\x25", // Set IBM864 codepage
          "\x1B\x52\x11", // Set Arabic character set

          // Header
          "\x1B\x61\x01", // Center align
          "\x1B\x45\x01", // Bold on
          "\x1B\x21\x10", // Double height
          "ŸÖÿ∑ÿπŸÖ ÿßŸÑŸÅŸàŸÑ ŸàÿßŸÑŸÅŸÑÿßŸÅŸÑ\n", // Restaurant name
          "\x1B\x21\x00", // Normal size
          "\x1B\x45\x00", // Bold off

          "ÿ¥ÿßÿ±ÿπ ÿßŸÑŸÖŸÑŸÉ ŸÅŸáÿØÿå ÿßŸÑÿ±Ÿäÿßÿ∂\n", // Address
          "ÿßŸÑŸáÿßÿ™ŸÅ: Ÿ†Ÿ°Ÿ°-Ÿ§Ÿ•Ÿ¶-ŸßŸ®Ÿ©Ÿ†\n", // Phone
          "ÿßŸÑÿ±ŸÇŸÖ ÿßŸÑÿ∂ÿ±Ÿäÿ®Ÿä: Ÿ£Ÿ†Ÿ†-Ÿ§Ÿ•Ÿ¶-ŸßŸ®Ÿ©\n", // Tax number
          "\x1B\x61\x00", // Left align
          "\n",

          // Date and order info
          "\x1B\x61\x02", // Right align
          "Ÿ¢Ÿ†Ÿ¢Ÿ§/Ÿ°Ÿ¢/Ÿ¢Ÿ• Ÿ°Ÿ§:Ÿ£Ÿ†\n", // Date and time
          "\x1B\x61\x00", // Left align
          "ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ®: Ÿ°Ÿ¢Ÿ£Ÿ§Ÿ•\n", // Order number
          "ÿßŸÑŸÉÿßÿ¥Ÿäÿ±: ÿ£ÿ≠ŸÖÿØ ŸÖÿ≠ŸÖÿØ\n", // Cashier
          "\n",

          // Customer info
          "ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿπŸÖŸäŸÑ:\n", // Customer data
          "--------------------------------\n",
          "ÿßŸÑÿßÿ≥ŸÖ: ÿ≥ÿßÿ±ÿ© ÿ£ÿ≠ŸÖÿØ\n", // Name
          "ÿßŸÑŸáÿßÿ™ŸÅ: Ÿ†Ÿ•Ÿ†-Ÿ°Ÿ¢Ÿ£-Ÿ§Ÿ•Ÿ¶Ÿß\n", // Phone
          "\n",

          // Items
          "================================\n",
          "ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ∑ŸÑÿ®:\n", // Order details
          "================================\n",

          "\x1B\x61\x02", // Right align for Arabic
          "ŸÅŸàŸÑ ŸÖÿØŸÖÿ≥\n", // Item 1
          "\x1B\x61\x00", // Left align for numbers
          "2 √ó 15.50 = 31.00 ÿ±ŸäÿßŸÑ\n",
          "\n",

          "\x1B\x61\x02", // Right align
          "ŸÅŸÑÿßŸÅŸÑ ŸÖÿπ ÿßŸÑÿ∑ÿ≠ŸäŸÜÿ©\n", // Item 2
          "\x1B\x61\x00", // Left align
          "1 √ó 12.00 = 12.00 ÿ±ŸäÿßŸÑ\n",
          "\n",

          "\x1B\x61\x02", // Right align
          "ÿ≠ŸÖÿµ ÿ®ÿßŸÑÿ∑ÿ≠ŸäŸÜÿ©\n", // Item 3
          "\x1B\x61\x00", // Left align
          "1 √ó 8.50 = 8.50 ÿ±ŸäÿßŸÑ\n",
          "\n",

          "\x1B\x61\x02", // Right align
          "ÿÆÿ®ÿ≤ ÿπÿ±ÿ®Ÿä\n", // Item 4
          "\x1B\x61\x00", // Left align
          "3 √ó 2.00 = 6.00 ÿ±ŸäÿßŸÑ\n",

          "--------------------------------\n",

          // Totals
          "\x1B\x61\x02", // Right align
          "ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÅÿ±ÿπŸä:\n", // Subtotal
          "\x1B\x61\x00", // Left align
          "57.50 ÿ±ŸäÿßŸÑ\n",

          "\x1B\x61\x02", // Right align
          "ÿßŸÑÿ∂ÿ±Ÿäÿ®ÿ© (Ÿ°Ÿ•Ÿ™):\n", // Tax
          "\x1B\x61\x00", // Left align
          "8.63 ÿ±ŸäÿßŸÑ\n",

          "================================\n",

          "\x1B\x45\x01", // Bold on
          "\x1B\x21\x10", // Double height
          "\x1B\x61\x02", // Right align
          "ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÉŸÑŸä:\n", // Total
          "\x1B\x61\x00", // Left align
          "66.13 ÿ±ŸäÿßŸÑ\n",
          "\x1B\x21\x00", // Normal size
          "\x1B\x45\x00", // Bold off

          "================================\n",

          // Payment
          "\x1B\x61\x02", // Right align
          "ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ: ŸÜŸÇÿØÿßŸã\n", // Payment method
          "ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿØŸÅŸàÿπ: 70.00 ÿ±ŸäÿßŸÑ\n", // Amount paid
          "ÿßŸÑÿ®ÿßŸÇŸä: 3.87 ÿ±ŸäÿßŸÑ\n", // Change
          "\n",

          // Footer
          "\x1B\x61\x01", // Center align
          "\x1B\x45\x01", // Bold on
          "ÿ¥ŸÉÿ±ÿßŸã ŸÑÿ≤Ÿäÿßÿ±ÿ™ŸÉŸÖ\n", // Thank you
          "\x1B\x45\x00", // Bold off
          "Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßÿ≠ÿ™ŸÅÿßÿ∏ ÿ®ÿßŸÑÿ•ŸäÿµÿßŸÑ\n", // Keep receipt
          "\n",
          "www.foul-flafel.com\n",

          "\x1B\x61\x00", // Left align
          "\x1B\x52\x00", // Reset charset
          "\n\n\n",
          "\x1B\x69", // Cut paper
        ];

        return commands.join("");
      }

      // Convert ESC/POS commands to readable preview
      function convertCommandsToPreview(commands) {
        let preview = commands;

        // Remove ESC/POS commands for preview
        preview = preview.replace(/\x1B[\x40\x45\x21\x61\x74\x52\x69]/g, "");
        preview = preview.replace(/\x1B[\x40-\xFF]./g, "");

        // Clean up extra control characters
        preview = preview.replace(/[\x00-\x1F]/g, function (match) {
          return match === "\n" ? "\n" : "";
        });

        return preview;
      }

      // Initialize on page load
      window.onload = function () {
        log("Arabic Thermal Printer Test initialized");
        log("Make sure QZ Tray is running before connecting");

        // Auto-connect if QZ is available
        if (typeof qz !== "undefined") {
          setTimeout(connectQZ, 1000);
        } else {
          updateStatus("‚ùå QZ Tray library not loaded", "error");
          log("QZ Tray library not available", "error");
        }
      };
    </script>
  </body>
</html>
