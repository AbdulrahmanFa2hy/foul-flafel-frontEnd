import{u as Y,a as Z,b as L,r as b,j as e,M,f as E,g as V,h as ee}from"./index-tqPMu7ay.js";function te({stock:a=null,onClose:U,isViewMode:s=!1}){const{t:r,i18n:D}=Y(),R=D.language==="ar",k=Z(),{loading:w,error:I,stocks:g}=L(t=>t.stock),{user:o}=L(t=>t.auth),l=!!a&&!s,[n,A]=b.useState({name:(a==null?void 0:a.nameOfItem)||(a==null?void 0:a.name)||"",supplierName:(a==null?void 0:a.supplierName)||"",quantity:(a==null?void 0:a.quantity)||"",unit:(a==null?void 0:a.unit)||"pcs",pricePerUnit:(a==null?void 0:a.pricePerUnit)||(a==null?void 0:a.price)||"",minimumQuantity:(a==null?void 0:a.minimumQuantity)||"",managerId:(a==null?void 0:a.managerId)||(o==null?void 0:o._id)||"",invoiceType:"Cash",paidAmount:""}),[u,Q]=b.useState({}),[$,v]=b.useState([]),[q,j]=b.useState(!1),[F,C]=b.useState(!0),[c,T]=b.useState(null);b.useEffect(()=>{var t;if(a){const i=(t=a.invoice)==null?void 0:t[0],m=a.quantity*(a.pricePerUnit||a.price||0),d=i?m-(i.residualValue||0):m;A({name:a.nameOfItem||a.name||"",supplierName:a.supplierName||"",quantity:a.quantity||"",unit:a.unit||"pcs",pricePerUnit:a.pricePerUnit||a.price||"",minimumQuantity:a.minimumQuantity||"",managerId:a.managerId||(o==null?void 0:o._id)||"",invoiceType:(i==null?void 0:i.type)||"Cash",paidAmount:d||""}),C(!1),T(a)}},[a,o]),b.useEffect(()=>{if(!a&&q)if(n.name&&n.name.length>=1){const t=g.filter(i=>i.name.toLowerCase().includes(n.name.toLowerCase()));v(t),j(t.length>0)}else n.name===""&&q&&(v(g),j(g.length>0));else(a||!q)&&(v([]),j(!1))},[n.name,g,a,q]);const _=()=>{if(!a&&!s){if(j(!0),n.name.trim()==="")v(g);else if(n.name.length>=1){const t=g.filter(i=>i.name.toLowerCase().includes(n.name.toLowerCase()));v(t)}}},B=()=>{setTimeout(()=>{j(!1),v([])},200)},P=()=>{const t=Number(n.quantity)||0,i=Number(n.pricePerUnit)||0;return(t*i).toFixed(2)},O=()=>{const t=Number(P())||0,i=Number(n.paidAmount)||0;return Math.max(0,t-i).toFixed(2)},W=()=>{const t=Number(P()),i=Number(n.paidAmount)||0;return i<=0?{status:"Not Paid",color:"red"}:i>=t?{status:"Fully Paid",color:"green"}:{status:"Partial Payment",color:"yellow"}},z=t=>{T(t),C(!1),A({name:t.name,supplierName:t.supplierName,quantity:t.quantity,unit:t.unit,pricePerUnit:t.pricePerUnit,minimumQuantity:t.minimumQuantity||"",managerId:t.managerId||(o==null?void 0:o._id)||"",invoiceType:"Cash",paidAmount:""}),j(!1)},x=t=>{const{name:i,value:m,type:d}=t.target;let S=d==="number"?m===""?"":Number(m):m;A(p=>{const f={...p,[i]:S};if(i==="name"&&c&&(g.find(N=>N.name.toLowerCase()===m.toLowerCase())||(T(null),C(!0))),i==="invoiceType")if(m==="Cash"){const y=(Number(p.quantity)||0)*(Number(p.pricePerUnit)||0);f.paidAmount=y}else f.paidAmount=f.paidAmount||0;if((i==="quantity"||i==="pricePerUnit")&&f.invoiceType==="Cash"){const y=i==="quantity"?S:p.quantity,N=i==="pricePerUnit"?S:p.pricePerUnit,X=(Number(y)||0)*(Number(N)||0);f.paidAmount=X}return f}),u[i]&&Q(p=>({...p,[i]:""}))},G=()=>{const t={};n.name.trim()||(t.name=r("forms.stockForm.nameRequired")),n.supplierName.trim()||(t.supplierName=r("forms.stockForm.supplierRequired")),(!n.quantity||n.quantity<=0)&&(t.quantity=r("forms.stockForm.quantityRequired")),(!n.pricePerUnit||n.pricePerUnit<=0)&&(t.pricePerUnit=r("forms.stockForm.priceRequired")),n.minimumQuantity!==""&&n.minimumQuantity<0&&(t.minimumQuantity="Minimum quantity cannot be negative");const i=n.managerId||(o==null?void 0:o._id);if(i?/^[0-9a-fA-F]{24}$/.test(i)||(t.managerId="Invalid manager ID format"):t.managerId="Manager ID is required",!l&&!s&&F){const m=Number(P()),d=Number(n.paidAmount)||0;m<=0&&(t.pricePerUnit="Total cost must be greater than 0"),d<0&&(t.paidAmount="Paid amount cannot be negative"),d>m&&(t.paidAmount="Paid amount cannot exceed total cost"),n.invoiceType==="Postponed"&&d===m&&(t.paidAmount="For postponed payments, paid amount should be less than total")}return Q(t),Object.keys(t).length===0},H=async t=>{var i;if(t.preventDefault(),!!G())try{const m=n.managerId||(o==null?void 0:o._id),d=Number(P()),S=Number(n.paidAmount)||0,p=Math.max(0,d-S),f={name:n.name,supplierName:n.supplierName,quantity:Number(n.quantity),pricePerUnit:Number(n.pricePerUnit),unit:n.unit,minimumQuantity:Number(n.minimumQuantity)||0,managerId:m};if(l)await k(E({stockId:a._id,stockData:f})).unwrap();else if(c&&!F){const y={...f,quantity:Number(c.quantity)+Number(n.quantity)},N=(i=c.invoice)==null?void 0:i[0];N?y.invoice=[{type:n.invoiceType,value:N.value+d,residualValue:N.residualValue+p}]:y.invoice=[{type:n.invoiceType,value:d,residualValue:p}],await k(E({stockId:c._id,stockData:y})).unwrap()}else f.invoice=[{type:n.invoiceType,value:d,residualValue:p}],await k(V(f)).unwrap();k(ee()),U()}catch(m){console.error("Error saving stock:",m)}},J=()=>s?r("forms.stockForm.viewStock"):l?r("forms.stockForm.editStock"):c&&!F?`${r("forms.stockForm.updateStock")}: ${c.name}`:r("forms.stockForm.addStock"),h=W(),K=t=>{switch(t){case"Fully Paid":return r("forms.stockForm.fullyPaid");case"Partial Payment":return r("forms.stockForm.partialPayment");case"Not Paid":return r("forms.stockForm.notPaid");default:return t}};return e.jsx(M,{title:J(),onClose:U,children:e.jsx("div",{className:"space-y-4",dir:R?"rtl":"ltr",children:e.jsxs("form",{onSubmit:H,children:[I&&e.jsx("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded-md text-sm",children:I}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[r("forms.stockForm.itemName")," *"]}),e.jsx("input",{type:"text",name:"name",value:n.name,onChange:x,className:`w-full mb-2 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 ${u.name?"border-red-500":"border-gray-300"}`,placeholder:r("forms.stockForm.enterItemName"),required:!0,onFocus:_,onBlur:B}),u.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r("forms.stockForm.nameRequired")}),q&&$.length>0&&!s&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto",children:[e.jsx("div",{className:"p-2 bg-blue-50 border-b text-xs text-blue-700",children:r("forms.stockForm.existingStocksFound")}),$.map(t=>e.jsxs("div",{className:"p-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0",onClick:()=>z(t),children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:[r("forms.stockForm.currentQuantityLabel"),":"," ",t.quantity," ",t.unit," |",r("forms.stockForm.supplierName"),":"," ",t.supplierName," | $",t.pricePerUnit,"/",t.unit]}),t.minimumQuantity>0&&e.jsxs("div",{className:"text-xs text-orange-600",children:[r("forms.stockForm.minStockLevel"),":"," ",t.minimumQuantity," ",t.unit]})]},t._id))]}),c&&!F&&!l&&e.jsx("div",{className:"my-3 p-2 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsxs("strong",{children:[r("forms.stockForm.updateMode"),":"]})," ",r("forms.stockForm.addingToExistingStock"),' "',c.name,'".'," ",r("forms.stockForm.currentQuantityLabel"),":"," ",c.quantity," ",c.unit]})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[r("forms.stockForm.supplierName")," *"]}),e.jsx("input",{type:"text",name:"supplierName",value:n.supplierName,onChange:x,className:`w-full mb-5 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 ${u.supplierName?"border-red-500":"border-gray-300"}`,placeholder:r("forms.stockForm.enterSupplierName"),required:!0}),u.supplierName&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r("forms.stockForm.supplierRequired")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[r("forms.stockForm.quantity")," *"," ",c&&!F&&!l&&`(${r("forms.stockForm.additionalQuantity")})`]}),e.jsx("input",{type:"number",name:"quantity",value:n.quantity,onChange:x,className:`w-full mb-5 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 ${u.quantity?"border-red-500":"border-gray-300"}`,placeholder:r(c&&!F&&!l?"forms.stockForm.enterAdditionalQuantity":"forms.stockForm.enterQuantity"),min:"0",step:"0.01",required:!s}),u.quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r("forms.stockForm.quantityRequired")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[r("forms.stockForm.unit")," *"]}),e.jsxs("select",{name:"unit",value:n.unit,onChange:x,className:`w-full mb-5 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 ${s?"bg-gray-100":"border-gray-300"}`,required:!s,disabled:s,children:[e.jsx("option",{value:"pcs",children:r("forms.stockForm.pieces")}),e.jsx("option",{value:"kg",children:r("forms.stockForm.kilogram")}),e.jsx("option",{value:"grams",children:r("forms.stockForm.grams")}),e.jsx("option",{value:"liters",children:r("forms.stockForm.liters")}),e.jsx("option",{value:"ml",children:r("forms.stockForm.milliliters")}),e.jsx("option",{value:"cans",children:r("forms.stockForm.cans")}),e.jsx("option",{value:"cups",children:r("forms.stockForm.cups")}),e.jsx("option",{value:"tsp",children:r("forms.stockForm.teaspoon")}),e.jsx("option",{value:"tbsp",children:r("forms.stockForm.tablespoon")}),e.jsx("option",{value:"packets",children:r("forms.stockForm.packets")}),e.jsx("option",{value:"boxes",children:r("forms.stockForm.boxes")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[r("forms.stockForm.pricePerUnit")," ($) *"]}),e.jsx("input",{type:"number",name:"pricePerUnit",value:n.pricePerUnit,onChange:x,className:`w-full mb-5 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 ${u.pricePerUnit?"border-red-500":"border-gray-300"}`,placeholder:r("forms.stockForm.enterPricePerUnit"),min:"0",step:"0.01",required:!s}),u.pricePerUnit&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r("forms.stockForm.priceRequired")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:r("forms.stockForm.minStockLevel")}),e.jsx("input",{type:"number",name:"minimumQuantity",value:n.minimumQuantity,onChange:x,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 ${u.minimumQuantity?"border-red-500":"border-gray-300"}`,placeholder:r("forms.stockForm.enterMinLevel"),min:"0",step:"1"}),u.minimumQuantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r("forms.stockForm.minimumQuantityError")}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r("forms.stockForm.getNotifiedWhenStockFallsBelowLevel")})]})]}),n.quantity&&n.pricePerUnit&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3 my-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-800",children:[r("forms.stockForm.totalValue"),":"]}),e.jsxs("span",{className:"text-lg font-bold text-blue-900",children:["$",P()]})]}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[n.quantity," ",n.unit," × $",n.pricePerUnit," ",r("forms.stockForm.per")," ",n.unit]})]}),(!l||l&&n.invoiceType==="Postponed")&&e.jsxs("div",{className:"pt-4",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:r("forms.stockForm.paymentType")}),e.jsxs("select",{name:"invoiceType",value:n.invoiceType,onChange:x,className:"w-full mb-5 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-gray-100",children:[e.jsx("option",{value:"Cash",children:r("forms.stockForm.cash")}),e.jsx("option",{value:"Postponed",children:r("forms.stockForm.postponed")})]}),l&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:r("forms.stockForm.noteEditingPaymentTypeWillAffectFinancialRecords")})]}),(n.invoiceType==="Postponed"||l)&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[r("forms.stockForm.paidAmount")," ($)"," ",!s&&!l&&"*"]}),e.jsx("input",{type:"number",name:"paidAmount",value:n.paidAmount,onChange:x,className:`w-full mb-5 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 ${u.paidAmount?"border-red-500":"border-gray-300"} ${s||!l&&n.invoiceType==="Cash"?"bg-gray-100":""}`,placeholder:r("forms.stockForm.enterPaidAmount"),min:"0",max:P(),step:"0.01",required:!s&&!l&&n.invoiceType==="Postponed"}),u.paidAmount&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:u.paidAmount})]}),n.quantity&&n.pricePerUnit&&e.jsx("div",{className:`p-4 mb-2 rounded-md border ${h.color==="green"?"bg-green-50 border-green-200":h.color==="yellow"?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[r("forms.stockForm.paymentStatus"),":"]}),e.jsx("span",{className:`ms-2 ${h.color==="green"?"text-green-800":h.color==="yellow"?"text-yellow-800":"text-red-800"}`,children:K(h.status)})]}),e.jsx("div",{children:e.jsxs("span",{className:`font-medium ${h.color==="green"?"text-green-800":h.color==="yellow"?"text-yellow-800":"text-red-800"}`,children:[r("forms.stockForm.remaining"),": $",O()]})})]})})]}),s&&a&&e.jsx("div",{className:"pt-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[e.jsx("div",{children:e.jsxs("span",{className:"font-medium text-gray-700",children:[r("forms.stockForm.created"),":"," ",new Date(a.createdAt).toLocaleDateString()]})}),e.jsx("div",{children:e.jsxs("span",{className:"font-medium text-gray-700",children:[r("forms.stockForm.lastUpdated"),":"," ",new Date(a.updatedAt).toLocaleDateString()]})})]})}),e.jsxs("div",{className:"flex justify-start gap-3",children:[!s&&e.jsx("button",{type:"submit",disabled:w,className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:r(w?"forms.stockForm.saving":l?"forms.stockForm.updateStock":"forms.stockForm.createStock")}),e.jsx("button",{type:"button",className:"px-10 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",onClick:U,disabled:w&&!s,children:r(s?"common.close":"common.cancel")})]})]})})})}export{te as default};
