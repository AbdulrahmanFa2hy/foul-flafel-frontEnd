import{u as R,a as S,b as U,r as l,N as $,V as w,O as M,P as L,Q as z,j as e,M as T,R as O,D as V,S as _}from"./index-DX1FWjf4.js";const B=({user:o,onClose:x})=>{var F;const{t:r,i18n:C}=R(),f=C.language==="ar",d=!!o,c=S(),{loading:h,error:b}=U(a=>a.users),{user:y}=U(a=>a.auth),[s,v]=l.useState({name:(o==null?void 0:o.name)||"",username:(o==null?void 0:o.username)||"",password:"",confirmPassword:"",role:(o==null?void 0:o.role)||"cashier",active:(o==null?void 0:o.active)!==void 0?o.active:!0,image:null}),[N,P]=l.useState(((F=o==null?void 0:o.image)==null?void 0:F.url)||null),[t,p]=l.useState({}),D=l.useCallback(a=>a?a.split(" ").map(m=>m[0]).join("").toUpperCase().substring(0,2):"",[]);l.useEffect(()=>{c($())},[c]),l.useEffect(()=>{b&&w.error(b)},[b]);const u=l.useCallback(a=>{const{name:m,value:i,type:n,checked:k}=a.target;v(j=>({...j,[m]:n==="checkbox"?k:i})),p(j=>({...j,[m]:""}))},[]),E=l.useCallback(a=>{const m=a.target.files[0];if(m){if(m.size>5*1024*1024){p(n=>({...n,image:r("forms.userForm.imageSize")}));return}if(!m.type.startsWith("image/")){p(n=>({...n,image:r("forms.userForm.imageType")}));return}const i=new FileReader;i.onloadend=()=>{P(i.result),v(n=>({...n,image:m})),p(n=>({...n,image:""}))},i.readAsDataURL(m)}},[]),g=l.useCallback(()=>{const a={};return s.name.trim()||(a.name=r("forms.userForm.nameRequired")),s.username.trim()?s.username.length<3&&(a.username=r("forms.userForm.usernameMinLength")):a.username=r("forms.userForm.usernameRequired"),d||(s.password?s.password.length<6&&(a.password=r("forms.userForm.passwordMinLength")):a.password=r("forms.userForm.passwordRequired"),s.password!==s.confirmPassword&&(a.confirmPassword=r("forms.userForm.passwordsDoNotMatch"))),a},[s,d]),I=l.useCallback(async a=>{a.preventDefault();const m=g();if(Object.keys(m).length>0){p(m);return}try{const i={name:s.name,username:s.username,role:s.role,active:s.active};!d&&s.password&&(i.password=s.password),s.image&&(i.image=s.image);let n;d?(n=(await c(M({userId:o._id,userData:i})).unwrap()).data,w.success(r("users.userUpdated")),y&&o._id===y._id&&c(L(n))):(await c(z(i)).unwrap(),w.success(r("users.userCreated"))),x(!0)}catch(i){console.error("Form submission error:",i)}},[s,d,o,y,c,g,x]),q=l.useMemo(()=>{const a=g();return Object.keys(a).length===0},[g]);return e.jsx("div",{dir:f?"rtl":"ltr",children:e.jsx(T,{title:r(d?"forms.userForm.editUser":"forms.userForm.addUser"),onClose:x,size:"md",children:e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-24 w-24 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center mb-2 cursor-pointer border-2 border-dashed border-gray-300 hover:border-primary-500 transition-colors",onClick:()=>document.getElementById("imageInput").click(),children:N?e.jsx("img",{src:N,alt:r("forms.userForm.profileImage"),className:"h-full w-full object-cover"}):e.jsx("div",{className:"text-center",children:d&&s.name?e.jsx("div",{className:"w-full h-full bg-primary-50 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-primary-800 text-lg font-medium",children:D(s.name)})}):e.jsxs(e.Fragment,{children:[e.jsx(O,{size:24,className:"text-gray-400 mx-auto mb-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:r("users.imageUpload")})]})})}),e.jsx("input",{id:"imageInput",type:"file",accept:"image/*",onChange:E,className:"hidden"})]}),t.image&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.image})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(V,{className:`inline ${f?"ml-2":"mr-2"}`}),r("forms.userForm.fullName")," *"]}),e.jsx("input",{type:"text",name:"name",value:s.name,onChange:u,className:`px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-800/50 focus:border-primary-800 w-full ${t.name?"border-red-500":"border-gray-300"}`,placeholder:r("forms.userForm.enterFullName"),required:!0}),t.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.name})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[r("forms.userForm.username")," *"]}),e.jsx("input",{type:"text",name:"username",value:s.username,onChange:u,className:`px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-800/50 focus:border-primary-800 w-full ${t.username?"border-red-500":"border-gray-300"}`,placeholder:r("forms.userForm.enterUsername"),required:!0}),t.username&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.username})]})]}),!d&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(_,{className:`inline ${f?"ml-2":"mr-2"}`}),r("forms.userForm.password")," *"]}),e.jsx("input",{type:"password",name:"password",value:s.password,onChange:u,className:`px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-800/50 focus:border-primary-800 w-full ${t.password?"border-red-500":"border-gray-300"}`,placeholder:r("forms.userForm.enterPassword"),required:!0}),t.password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.password})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[r("forms.userForm.confirmPassword")," *"]}),e.jsx("input",{type:"password",name:"confirmPassword",value:s.confirmPassword,onChange:u,className:`px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-800/50 focus:border-primary-800 w-full ${t.confirmPassword?"border-red-500":"border-gray-300"}`,placeholder:r("forms.userForm.confirmPasswordText"),required:!0}),t.confirmPassword&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.confirmPassword})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[r("forms.userForm.role")," *"]}),e.jsxs("select",{name:"role",value:s.role,onChange:u,className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-800/50 focus:border-primary-800 w-full",required:!0,children:[e.jsx("option",{value:"cashier",children:r("forms.userForm.cashier")}),e.jsx("option",{value:"manager",children:r("forms.userForm.manager")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("forms.userForm.status")}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx("input",{type:"checkbox",name:"active",checked:s.active,onChange:u,className:"h-4 w-4 text-primary rounded focus:ring-primary-800"}),e.jsx("span",{className:`${f?"mr-2":"ml-2"} text-gray-700`,children:r("forms.userForm.activeUser")})]})]})]}),e.jsxs("div",{className:`flex justify-end space-x-3 pt-4 border-t border-gray-200 ${f?"space-x-reverse":""}`,children:[e.jsx("button",{type:"button",className:"btn-outline",onClick:x,disabled:h,children:r("common.cancel")}),e.jsx("button",{type:"submit",disabled:h||!q,className:"px-4 py-2 rounded-md text-white font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-opacity-50 bg-primary-800 hover:bg-primary-800 focus:ring-primary-800/50 disabled:opacity-50 disabled:cursor-not-allowed",children:r(h?d?"forms.userForm.updating":"forms.userForm.creating":d?"forms.userForm.updateUser":"forms.userForm.createUser")})]})]})})})};export{B as default};
