const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PrintReceiptModal-BebAn9Uh.js","assets/index--ur9RtKA.js","assets/index-3IXj75bd.css"])))=>i.map(i=>d[i]);
import{j as e,u as F,a as q,J as B,b as w,r as j,V as f,K as G,L as N,_ as H}from"./index--ur9RtKA.js";const C=({label:r,value:c,onChange:o,placeholder:u="0",min:x="0",max:g,step:t="0.01",className:m=""})=>{const b=v=>{v.target.select()},n=v=>{const l=v.target.value;if(l==="")o("");else{const S=t==="1"?parseInt(l):parseFloat(l);o(isNaN(S)?"":S)}};return e.jsxs("div",{className:m,children:[r&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:r}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",value:c??"",onChange:n,onFocus:b,placeholder:u,min:x,max:g,step:t})]})};function R({value:r,onChange:c}){const{t:o}=F();return e.jsxs("select",{value:r,onChange:c,className:"w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"cash",children:o("cashier.cash")}),e.jsx("option",{value:"visa",children:o("payment.visa")})]})}const O=({subtotal:r,discount:c,discountAmount:o,tax:u,taxAmount:x,finalTotal:g})=>{const{t}=F();return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2 sm:p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[t("cashier.subtotal"),":"]}),e.jsxs("span",{className:"font-medium",children:[r.toFixed(2)," AED"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[t("cashier.discount")," (",c||0,"%):"]}),e.jsxs("span",{className:"font-medium text-red-600",children:["-",o.toFixed(2)," AED"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[t("cashier.tax")," (",u||0,"%):"]}),e.jsxs("span",{className:"font-medium",children:["+",x.toFixed(2)," AED"]})]}),e.jsx("div",{className:"border-t border-gray-300 pt-2",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsxs("span",{children:[t("cashier.total"),":"]}),e.jsxs("span",{className:"text-primary-700",children:[g.toFixed(2)," AED"]})]})})]})};function Q({paymentMode:r,setPaymentMode:c}){const{t:o}=F();return e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1 mb-4",children:[e.jsx("button",{type:"button",onClick:()=>c("single"),className:`flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors ${r==="single"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:o("payment.singlePayment")}),e.jsx("button",{type:"button",onClick:()=>c("split"),className:`flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors ${r==="split"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:o("payment.splitPayment")})]})}const X=({payment:r,index:c,onMethodChange:o,onAmountChange:u,finalTotal:x})=>{const g=t=>{u(c,t);const m=c===0?1:0;if(u(m,""),t&&!isNaN(t)){const b=x-parseFloat(t);b>0?u(m,parseFloat(b.toFixed(2))):u(m,0)}};return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(R,{value:r.method,onChange:t=>o(c,t.target.value)})}),e.jsx("div",{className:"flex-1",children:e.jsx(C,{value:r.amount,onChange:g,placeholder:"0.00",min:"0",step:"1"})})]})},Y=j.lazy(()=>H(()=>import("./PrintReceiptModal-BebAn9Uh.js"),__vite__mapDeps([0,1,2])));function ee({tax:r,setTax:c,discount:o,setDiscount:u,subtotal:x,discountAmount:g}){const{t}=F(),m=q(),b=B(),{currentOrder:n}=w(s=>s.order),{loading:v}=w(s=>s.payment),{currentShift:l}=w(s=>s.shift),{user:S}=w(s=>s.auth),[P,D]=j.useState("single"),[_,$]=j.useState("cash"),[A,M]=j.useState([{method:"cash",amount:""},{method:"visa",amount:""}]),[T,k]=j.useState(!1),E=x*(r||0)/100,h=x-g+E,L=j.useCallback((s,d)=>{M(i=>{const a=[...i];return a[s].method=d,a})},[]),z=j.useCallback((s,d)=>{M(i=>{const a=[...i];return a[s].amount=d,a})},[]),J=A.reduce((s,d)=>{const i=parseFloat(d.amount)||0;return s+i},0),V=h-J,K=()=>{const s=A.filter(i=>(parseFloat(i.amount)||0)>0);if(s.length===0)return{isValid:!1,message:t("payment.enterPaymentAmount")};const d=s.reduce((i,a)=>i+parseFloat(a.amount),0);if(d<h)return{isValid:!1,message:`${t("payment.needMoreAmount")} ${(h-d).toFixed(2)} AED`};if(d>h){const i=[...s];let a=h;for(let p=0;p<i.length;p++){const y=parseFloat(i[p].amount);if(a>=y)a-=y;else{i[p].amount=a,a=0,i.splice(p+1);break}}return{isValid:!0,payments:i}}return{isValid:!0,payments:s}},U=async()=>{var s,d,i;if(!n){f.error(t("payment.noOrderSelected"));return}if(n.isPaid){f.error(t("payment.orderAlreadyPaid"));return}try{let a=[];if(P==="single")a=[{method:_,amount:h}];else{const y=K();if(!y.isValid){f.error(y.message);return}a=y.payments.map(I=>({method:I.method,amount:parseFloat(I.amount)}))}if((await m(G({orderId:n._id,paymentMethods:a,tax:r||0,discount:o||0})).unwrap()).alreadyPaid){f.success(t("payment.alreadyPaidSuccess"),{duration:3e3,icon:"✅"}),l!=null&&l._id?await m(N({shiftId:l._id})):await m(N()),setTimeout(()=>{b("/menu")},1500);return}l!=null&&l._id?await m(N({shiftId:l._id})):await m(N()),f.success(t("payment.paymentSuccess"),{duration:3e3,icon:"✅"}),setTimeout(()=>{b("/menu")},1500)}catch(a){console.error("Payment failed:",a);let p=t("payment.paymentFailedRetry"),y=!1;if(a.shouldRetry?(p=a.message+" Would you like to try again?",y=!0):a.message&&(p=a.message),(s=a.message)!=null&&s.includes("already paid")||(i=(d=a.originalError)==null?void 0:d.message)!=null&&i.includes("already paid")){l!=null&&l._id?await m(N({shiftId:l._id})):await m(N()),f.error(t("payment.paymentStatusUnclear"),{duration:5e3,icon:"⚠️"});return}f.error(p,{duration:y?6e3:4e3,icon:"❌"})}},W=()=>{if(!n){f.error(t("payment.noOrderSelected"));return}k(!0)};return e.jsxs("div",{className:"bg-white rounded-lg shadow-card p-2 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(C,{label:t("payment.taxPercent"),value:r,onChange:c,placeholder:"0",min:"0",max:"100",step:"1"}),e.jsx(C,{label:t("payment.discountPercent"),value:o,onChange:u,placeholder:"0",min:"0",max:"100",step:"1"})]}),e.jsx(O,{subtotal:x,discount:o,discountAmount:g,tax:r,taxAmount:E,finalTotal:h}),e.jsxs("div",{children:[e.jsx("label",{className:"hidden sm:block text-sm font-medium text-gray-700 mb-3",children:t("payment.paymentMethod")}),e.jsx(Q,{paymentMode:P,setPaymentMode:D}),P==="single"&&e.jsx(R,{value:_,onChange:s=>$(s.target.value)}),P==="split"&&e.jsxs("div",{className:"space-y-3",children:[A.map((s,d)=>e.jsx(X,{payment:s,index:d,onMethodChange:L,onAmountChange:z,finalTotal:h},d)),e.jsxs("div",{className:"text-sm text-gray-600 bg-blue-50 p-2 rounded text-start",children:[t("payment.remaining"),":"," ",e.jsx("span",{className:`font-medium ${V>0?"text-red-600":"text-green-600"}`,children:V.toFixed(2)})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:U,disabled:v||!n||(n==null?void 0:n.isPaid),className:`w-full py-3 px-4 rounded-md transition-colors font-medium ${n!=null&&n.isPaid?"bg-green-100 text-green-800 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed"}`,children:n!=null&&n.isPaid?t("payment.orderAlreadyPaid"):v?t("payment.processing"):`${t("payment.pay")} ${h.toFixed(2)} AED`}),e.jsx("button",{onClick:W,className:"w-full py-2 px-4 bg-primary-700 text-white rounded-md hover:bg-primary-800 transition-colors",children:n!=null&&n.isPaid?t("payment.printReceipt"):t("payment.printPreview")})]}),T&&e.jsx(j.Suspense,{fallback:e.jsx("div",{children:t("common.loading")}),children:e.jsx(Y,{order:n,onClose:()=>k(!1)})})]})}export{ee as default};
